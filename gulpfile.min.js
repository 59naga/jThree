(function(){var v,y,r,e,o,s,p,h,w,n,t,b,k,u,d,g,c,f,nt,tt,l,it,a,i,rt;u=require("path");n=require("gulp");rt=require("webpack-stream");o=require("gulp-connect");tt=require("gulp-typedoc");k=require("gulp-mocha");t=require("gulp-util");b=require("gulp-haml");h=require("fs");v=require("lodash");w=require("glob-array");y=require("yargs").argv;r=y.branch||"unknown";t.log("branch: "+r);it=["jThree/src/**/*.ts"];l="ci/docs";nt="jThree/refs/**/*.d.ts";c="jThree/test/build/test.js";f="./tsconfig.json";d="jThree/src";g="jThree/wwwroot";a=["jThree/wwwroot/**/*.js","jThree/wwwroot/**/*.html","jThree/wwwroot/**/*.goml"];e={main:{entry:"jThree/src/jThree.ts",name:"j3.js",dest:["jThree/bin/product","jThree/wwwroot"],watch:["jThree/src/**/*.ts","jThree/refs/**/*.d.ts","jThree/src/**/*.glsl","jThree/src/**/*.json"]},test:{entry:"jThree/test/Test.ts",name:"test.js",dest:["jThree/test/build"],watch:["jThree/test/**/*.ts","jThree/refs/**/*.d.ts"]}};p={colors:t.colors.supportsColor,hash:!1,timings:!0,chunks:!1,chunkModules:!1,modules:!1,children:!0,version:!0,cached:!1,cachedAssets:!1,reasons:!1,source:!1,errorDetails:!1};n.task("default",["build"]);n.task("build",["webpack:main"]);n.task("haml",function(){return n.src("jThree/wwwroot/**/*.hgoml").pipe(b({ext:".goml"})).pipe(n.dest("jThree/wwwroot/**"))});Object.keys(e).forEach(function(r){var o;return o=e[r],n.task("webpack:"+r,function(){i&&o.dest.length>=2&&n.watch(o.dest[0]+"/"+o.name,function(){return s(o.dest[0]+"/"+o.name,o.dest.slice(1))});return n.src(u.join(__dirname,o.entry)).pipe(rt({watch:i,output:{filename:o.name},resolve:{alias:{glm:"gl-matrix"},extensions:["",".js",".ts"],root:[d]},module:{loaders:[{test:/\.json$/,loader:"json"},{test:/\.glsl$/,loader:"shader"},{test:/\.ts$/,loader:"ts-loader",configFileName:f}]},glsl:{chunkPath:"./Chunk"}},null,function(n,i){return t.log(i.toString(p)),i.compilation.errors.length!==0?t.log(t.colors.black.bgYellow('If tsconfig.json is not up-to-date, run command: "./node_modules/.bin/gulp --require coffee-script/register update-tsconfig-files"')):void 0})).pipe(n.dest(o.dest[0])).on("end",function(){if(!i)return s(o.dest[0]+"/"+o.name,o.dest.slice(1))})})});s=function(t,i){var f,r,e,u;for(u=[],r=0,e=i.length;r<e;r++)f=i[r],u.push(n.src(t).pipe(n.dest(f)));return u};i=!1;n.task("enable-watch-mode",function(){return i=!0});n.task("watch:main",["enable-watch-mode","webpack:main","server","watch-reload"]);n.task("watch-reload",function(){return n.watch(a,["reload"])});n.task("watch",["watch:main"]);n.task("reload",function(){return n.src(a).pipe(o.reload())});n.task("server",function(){return o.server({root:g,livereload:!0})});n.task("travis",["webpack:main"],function(){});n.task("doc",function(){return n.src([].concat(it,nt)).pipe(tt({module:"commonjs",target:"es5",out:l+"/"+r,name:"jThree",json:l+"/"+r+".json"}))});n.task("test",["webpack:test"],function(){return n.start(["mocha"])});n.task("watch:test",["enable-watch-mode","webpack:test","watch-mocha"]);n.task("watch-mocha",function(){return n.watch(c,["mocha"])});n.task("mocha",function(){return n.src(c).pipe(k())});n.task("update-tsconfig-files",function(){var t,n;return n=JSON.parse(h.readFileSync(u.join(__dirname,f))),t=w.sync(n.filesGlob),n.files=v.uniq(t,!0),h.writeFileSync(u.join(__dirname,f),JSON.stringify(n,null,2))});n.task("tscfg",["update-tsconfig-files"])}).call(this);
//# sourceMappingURL=gulpfile.min.js.map
